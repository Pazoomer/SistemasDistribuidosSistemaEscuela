<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Moodle</title>
  <link rel="icon" href="/images/moodle.png" type="image/x-icon">
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/bootstrap-icons.css" rel="stylesheet">
  <link href="css/templatemo-kind-heart-charity.css" rel="stylesheet">
  <style>
    #listaMaterias {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
    }
  </style>

</head>

<body>

  <div class="container mt-5">
    <h2>Materias</h2>
    <div id="listaMaterias" class="d-flex flex-wrap gap-3"></div>
    <button id="cerrarSesionBtn" class="btn btn-danger">Cerrar sesión</button>
  </div>

  <script type="module">
    import { cargarMateriasPorMaestro } from './js/firebase.js';
    // Obtener el ID del usuario desde localStorage
    const rol = localStorage.getItem("rol");
    const correoUsuario = localStorage.getItem("correo");
    const idUsuario = localStorage.getItem("id");
    console.log("ID de usuario:", idUsuario);
    console.log("Correo de usuario:", correoUsuario);
    console.log("Rol de usuario:", rol);

    if (!rol) {
      window.location.href = "login.html"; // Si no hay sesión, redirige
    }

    // Mostrar opciones según el rol
    if (rol === "estudiante") {
      cargarMateriasPorAlumno(idUsuario)
        .then(materias => {
          const lista = document.getElementById("listaMaterias");
          lista.innerHTML = ""; // Limpiar antes de insertar

          if (materias.length === 0) {
            lista.innerHTML = "<li>No hay materias asignadas</li>";
          } else {
            materias.forEach(materia => {
              const li = document.createElement("li");
              li.textContent = materia.nombre;
              lista.appendChild(li);
            });
          }
        })
        .catch(error => {
          console.error("Error al cargar los datos:", error);
        });

    } else if (rol === "maestro") {
      cargarMateriasPorMaestro(idUsuario)
        .then(materias => {
          console.log("Materias filtradas:", materias);
          const lista = document.getElementById("listaMaterias");
          lista.innerHTML = ""; // Limpiar antes de insertar

          if (materias.length === 0) {
            lista.innerHTML = "<li>No hay materias asignadas</li>";
          } else {
            materias.forEach(materia => {
              const col = document.createElement("div");
              col.className = "col-12 col-md-4";

              col.innerHTML =
                '<div class="card h-100 shadow-sm">' +
                '<div class="card-body">' +
                '<h5 class="card-title">' + materia.nombre + '</h5>' +
                '<p class="card-text"><strong>ID:</strong> ' + materia.id + '</p>' +
                '</div>' +
                '</div>';
              lista.appendChild(col);
            });
          }
        })
        .catch(error => {
          console.error("Error al cargar los datos:", error);
        });
    }

  </script>
  <script type="module">
    import { cerrarSesionConFirebase } from './js/firebase.js';

    document.getElementById("cerrarSesionBtn").addEventListener("click", async () => {
      try {
        await cerrarSesionConFirebase();
      } catch (err) {
        console.error(err.message);
      }
      console.error("Error al cerrar sesión");
      localStorage.removeItem("rol");
      window.location.href = "login.html";
    });
  </script>

  <script type="module">
    //import {agregarDatosEjemplo} from './js/firebase.js';

    //agregarDatosEjemplo();

  </script>

  <script src="js/jquery.min.js"></script>
  <!-- <script src="js/bootstrap.min.js"></script> -->
  <script src="js/jquery.sticky.js"></script>
  <script src="js/click-scroll.js"></script>
  <script src="js/counter.js"></script>
  <script src="js/custom.js"></script>

</body>

</html>